# HLSL æ•°æ®ç±»å‹ç³»ç»Ÿ

#HLSL #æ•°æ®ç±»å‹ #åŸºç¡€

> å­¦ä¹  HLSL çš„åŸºç¡€æ•°æ®ç±»å‹ã€å‘é‡ã€çŸ©é˜µã€æ•°ç»„å’Œç»“æ„ä½“

## ğŸ“‹ ç›®å½•

- [åŸºç¡€ç±»å‹](#åŸºç¡€ç±»å‹)
- [å‘é‡ç±»å‹](#å‘é‡ç±»å‹)
- [çŸ©é˜µç±»å‹](#çŸ©é˜µç±»å‹)
- [æ•°ç»„å’Œç»“æ„ä½“](#æ•°ç»„å’Œç»“æ„ä½“)
- [å®è·µä»»åŠ¡](#å®è·µä»»åŠ¡)

---

## åŸºç¡€ç±»å‹

### æµ®ç‚¹ç±»å‹

#### `float` - 32ä½æµ®ç‚¹æ•°
- **ç²¾åº¦**ï¼š32ä½ IEEE 754 å•ç²¾åº¦æµ®ç‚¹æ•°
- **èŒƒå›´**ï¼šçº¦ Â±3.4 Ã— 10Â³â¸
- **ç²¾åº¦**ï¼šçº¦7ä½æœ‰æ•ˆæ•°å­—
- **å¸¸é‡è¡¨ç¤º**ï¼š`1.0` æˆ– `1.0f`ï¼ˆæ¨èä½¿ç”¨ `1.0`ï¼‰

```hlsl
float value = 1.0;        // âœ… æ¨è
float value2 = 1.0f;      // âœ… ä¹Ÿå¯ä»¥
float value3 = 1;         // âŒ ä¸æ¨èï¼ˆä¼šè¢«è§£é‡Šä¸ºæ•´æ•°ï¼‰
```

#### `half` - 16ä½æµ®ç‚¹æ•°
- **ç²¾åº¦**ï¼š16ä½åŠç²¾åº¦æµ®ç‚¹æ•°ï¼ˆåœ¨æŸäº›å¹³å°ä¸Šå¯èƒ½æ˜ å°„ä¸º floatï¼‰
- **èŒƒå›´**ï¼šçº¦ Â±65504
- **ç²¾åº¦**ï¼šçº¦3ä½æœ‰æ•ˆæ•°å­—
- **å¸¸é‡è¡¨ç¤º**ï¼š`1.0h`
- **ç”¨é€”**ï¼šç§»åŠ¨å¹³å°ä¼˜åŒ–ï¼Œé¢œè‰²å€¼ã€æ³•çº¿ç­‰ä¸éœ€è¦é«˜ç²¾åº¦çš„æ•°æ®

```hlsl
half color = 0.5h;
half3 normal = half3(0.0, 0.0, 1.0);
```

> âš ï¸ **æ³¨æ„**ï¼šåœ¨ Shader Model 5.0+ ä¸­ï¼Œ`half` å¯èƒ½è¢«å®šä¹‰ä¸º `min16float`ï¼Œå®é™…ç²¾åº¦å–å†³äºç¡¬ä»¶æ”¯æŒã€‚

#### `double` - 64ä½æµ®ç‚¹æ•°
- **ç²¾åº¦**ï¼š64ä½ IEEE 754 åŒç²¾åº¦æµ®ç‚¹æ•°
- **èŒƒå›´**ï¼šçº¦ Â±1.7 Ã— 10Â³â°â¸
- **ç²¾åº¦**ï¼šçº¦15-17ä½æœ‰æ•ˆæ•°å­—
- **ç”¨é€”**ï¼šéœ€è¦é«˜ç²¾åº¦çš„è®¡ç®—ï¼ˆè¾ƒå°‘ä½¿ç”¨ï¼‰

```hlsl
double precise_value = 1.0;
```

### æ•´æ•°ç±»å‹

#### `int` - 32ä½æœ‰ç¬¦å·æ•´æ•°
```hlsl
int count = 42;
int negative = -10;
```

#### `uint` - 32ä½æ— ç¬¦å·æ•´æ•°
```hlsl
uint index = 100u;
uint mask = 0xFFFFFFFF;
```

### å¸ƒå°”ç±»å‹

#### `bool` - å¸ƒå°”å€¼
```hlsl
bool is_enabled = true;
bool is_visible = false;
```

> âš ï¸ **æ³¨æ„**ï¼šåœ¨ HLSL ä¸­ï¼Œå¸ƒå°”å€¼åœ¨æ¡ä»¶è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼Œä½†å®é™…å­˜å‚¨å¯èƒ½å ç”¨æ•´æ•°ç©ºé—´ã€‚

---

## å‘é‡ç±»å‹

### å‘é‡å£°æ˜

HLSL æ”¯æŒ 2ã€3ã€4 ç»´å‘é‡ï¼š

```hlsl
float2 vec2;    // 2D å‘é‡
float3 vec3;    // 3D å‘é‡
float4 vec4;    // 4D å‘é‡

half2 hvec2;
int3 ivec3;
uint4 uvec4;
```

### å‘é‡æ„é€ 

```hlsl
// æ ‡é‡æ„é€ ï¼ˆæ‰€æœ‰åˆ†é‡ç›¸åŒï¼‰
float4 color = float4(1.0);           // (1.0, 1.0, 1.0, 1.0)

// åˆ†é‡æ„é€ 
float4 color2 = float4(1.0, 0.5, 0.0, 1.0);

// ä»å…¶ä»–å‘é‡æ„é€ 
float2 xy = float2(1.0, 2.0);
float4 xyzw = float4(xy, 3.0, 4.0);  // (1.0, 2.0, 3.0, 4.0)

// ä»æ ‡é‡å’Œå‘é‡ç»„åˆ
float3 rgb = float3(1.0, float2(0.5, 0.0));  // (1.0, 0.5, 0.0)
```

### Swizzle æ“ä½œ

Swizzle å…è®¸é‡æ–°æ’åˆ—å’Œé€‰æ‹©å‘é‡çš„åˆ†é‡ï¼š

#### åŸºæœ¬ Swizzle
```hlsl
float4 vec = float4(1.0, 2.0, 3.0, 4.0);

float2 xy = vec.xy;        // (1.0, 2.0)
float3 xyz = vec.xyz;      // (1.0, 2.0, 3.0)
float w = vec.w;           // 4.0
```

#### é‡æ’åˆ—
```hlsl
float4 vec = float4(1.0, 2.0, 3.0, 4.0);

float4 reversed = vec.wzyx;    // (4.0, 3.0, 2.0, 1.0)
float4 duplicated = vec.xxxx;  // (1.0, 1.0, 1.0, 1.0)
float2 swapped = vec.yx;       // (2.0, 1.0)
```

#### ä¸åŒå‘½åçº¦å®š
```hlsl
float4 vec = float4(1.0, 2.0, 3.0, 4.0);

// ä½ç½®å‘½åï¼ˆxyzwï¼‰
vec.xyzw

// é¢œè‰²å‘½åï¼ˆrgbaï¼‰
vec.rgba

// çº¹ç†åæ ‡å‘½åï¼ˆstpqï¼‰
vec.stpq
```

> âš ï¸ **æ³¨æ„**ï¼šä¸èƒ½æ··åˆä½¿ç”¨ä¸åŒçš„å‘½åçº¦å®šï¼Œä¾‹å¦‚ `vec.xgr` æ˜¯æ— æ•ˆçš„ã€‚

#### Swizzle èµ‹å€¼
```hlsl
float4 vec = float4(1.0, 2.0, 3.0, 4.0);
vec.xy = float2(10.0, 20.0);  // vec ç°åœ¨æ˜¯ (10.0, 20.0, 3.0, 4.0)
```

### å‘é‡è¿ç®—

```hlsl
float3 a = float3(1.0, 2.0, 3.0);
float3 b = float3(4.0, 5.0, 6.0);

float3 sum = a + b;        // (5.0, 7.0, 9.0)
float3 diff = a - b;       // (-3.0, -3.0, -3.0)
float3 scaled = a * 2.0;   // (2.0, 4.0, 6.0)
float3 product = a * b;    // åˆ†é‡ç›¸ä¹˜: (4.0, 10.0, 18.0)
```

---

## çŸ©é˜µç±»å‹

### çŸ©é˜µå£°æ˜

HLSL æ”¯æŒ 2Ã—2ã€3Ã—3ã€4Ã—4 çŸ©é˜µï¼š

```hlsl
float2x2 mat2x2;
float3x3 mat3x3;
float4x4 mat4x4;

// éæ–¹é˜µ
float4x3 mat4x3;  // 4è¡Œ3åˆ—
float3x4 mat3x4;  // 3è¡Œ4åˆ—
```

### çŸ©é˜µæ„é€ 

```hlsl
// æ ‡é‡æ„é€ ï¼ˆå¯¹è§’çº¿çŸ©é˜µï¼‰
float4x4 identity = float4x4(1.0);  // å¯¹è§’çº¿ä¸º1.0ï¼Œå…¶ä»–ä¸º0.0

// è¡Œä¸»åºæ„é€ ï¼ˆé€è¡Œï¼‰
float4x4 mat = float4x4(
    1.0, 0.0, 0.0, 0.0,  // ç¬¬ä¸€è¡Œ
    0.0, 1.0, 0.0, 0.0,  // ç¬¬äºŒè¡Œ
    0.0, 0.0, 1.0, 0.0,  // ç¬¬ä¸‰è¡Œ
    0.0, 0.0, 0.0, 1.0   // ç¬¬å››è¡Œ
);

// ä»å‘é‡æ„é€ 
float4 row0 = float4(1.0, 0.0, 0.0, 0.0);
float4 row1 = float4(0.0, 1.0, 0.0, 0.0);
float4 row2 = float4(0.0, 0.0, 1.0, 0.0);
float4 row3 = float4(0.0, 0.0, 0.0, 1.0);
float4x4 mat2 = float4x4(row0, row1, row2, row3);
```

### çŸ©é˜µè®¿é—®

```hlsl
float4x4 mat = float4x4(1.0);

// è®¿é—®å•ä¸ªå…ƒç´ 
float element = mat[0][1];  // ç¬¬0è¡Œç¬¬1åˆ—

// è®¿é—®æ•´è¡Œ
float4 row0 = mat[0];       // ç¬¬0è¡Œ

// è®¿é—®æ•´åˆ—ï¼ˆéœ€è¦è½¬ç½®æˆ–æ‰‹åŠ¨æå–ï¼‰
float4 col0 = float4(mat[0][0], mat[1][0], mat[2][0], mat[3][0]);
```

### çŸ©é˜µè¿ç®—

```hlsl
float4x4 a = float4x4(1.0);
float4x4 b = float4x4(1.0);

// çŸ©é˜µä¹˜æ³•
float4x4 product = mul(a, b);  // æˆ– a * bï¼ˆåœ¨æŸäº›ç‰ˆæœ¬ä¸­ï¼‰

// çŸ©é˜µä¸å‘é‡ä¹˜æ³•
float4 vec = float4(1.0, 2.0, 3.0, 1.0);
float4 transformed = mul(vec, mat);  // è¡Œå‘é‡ Ã— çŸ©é˜µ
float4 transformed2 = mul(mat, vec); // çŸ©é˜µ Ã— åˆ—å‘é‡

// è½¬ç½®
float4x4 transposed = transpose(mat);
```

> âš ï¸ **æ³¨æ„**ï¼šHLSL ä½¿ç”¨**è¡Œä¸»åº**å­˜å‚¨çŸ©é˜µï¼Œè¿™ä¸æŸäº› APIï¼ˆå¦‚ OpenGLï¼‰çš„åˆ—ä¸»åºä¸åŒã€‚

---

## æ•°ç»„å’Œç»“æ„ä½“

### æ•°ç»„

#### ä¸€ç»´æ•°ç»„
```hlsl
float array[10];           // 10ä¸ªfloat
float4 colors[5];         // 5ä¸ªfloat4å‘é‡

// åˆå§‹åŒ–
float values[3] = {1.0, 2.0, 3.0};
```

#### å¤šç»´æ•°ç»„
```hlsl
float matrix[4][4];       // 4Ã—4æ•°ç»„
float3 positions[100];    // 100ä¸ªfloat3å‘é‡
```

#### åŠ¨æ€ç´¢å¼•
```hlsl
float array[10];
int index = 5;
float value = array[index];  // åŠ¨æ€ç´¢å¼•è®¿é—®
```

> âš ï¸ **æ³¨æ„**ï¼šåœ¨æŸäº›ç€è‰²å™¨æ¨¡å‹ä¸­ï¼ŒåŠ¨æ€ç´¢å¼•å¯èƒ½æœ‰é™åˆ¶æˆ–æ€§èƒ½å½±å“ã€‚

### ç»“æ„ä½“

#### åŸºæœ¬ç»“æ„ä½“
```hlsl
struct VertexInput {
    float3 position : POSITION;
    float3 normal : NORMAL;
    float2 uv : TEXCOORD0;
};

struct VertexOutput {
    float4 position : SV_POSITION;
    float2 uv : TEXCOORD0;
    float3 worldPos : TEXCOORD1;
};
```

#### ç»“æ„ä½“ä½¿ç”¨
```hlsl
VertexInput input;
input.position = float3(0.0, 0.0, 0.0);
input.normal = float3(0.0, 0.0, 1.0);
input.uv = float2(0.0, 0.0);

// è®¿é—®æˆå‘˜
float3 pos = input.position;
```

#### å¯¹é½è§„åˆ™ï¼ˆPacking Rulesï¼‰

HLSL ç»“æ„ä½“éœ€è¦éµå¾ªå¯¹é½è§„åˆ™ï¼Œç‰¹åˆ«æ˜¯åœ¨å¸¸é‡ç¼“å†²åŒºä¸­ï¼š

```hlsl
// âŒ ä¸å¥½çš„å¯¹é½ï¼ˆæµªè´¹ç©ºé—´ï¼‰
struct BadPacking {
    float x;      // 4å­—èŠ‚
    float2 yz;    // 8å­—èŠ‚ï¼Œä½†éœ€è¦å¯¹é½åˆ°4å­—èŠ‚è¾¹ç•Œ
    float w;      // 4å­—èŠ‚
};
// æ€»å¤§å°ï¼šå¯èƒ½ä¸æ˜¯æœ€ä¼˜çš„

// âœ… å¥½çš„å¯¹é½
struct GoodPacking {
    float4 xyzw;  // 16å­—èŠ‚ï¼Œå®Œç¾å¯¹é½
};
```

**å¯¹é½è§„åˆ™**ï¼š
- æ ‡é‡ç±»å‹å¯¹é½åˆ°è‡ªèº«å¤§å°
- å‘é‡ç±»å‹å¯¹é½åˆ°4å­—èŠ‚è¾¹ç•Œ
- ç»“æ„ä½“å¯¹é½åˆ°æœ€å¤§æˆå‘˜çš„å¯¹é½è¦æ±‚
- åœ¨å¸¸é‡ç¼“å†²åŒºä¸­ï¼Œé€šå¸¸éœ€è¦å¯¹é½åˆ° `float4`ï¼ˆ16å­—èŠ‚ï¼‰è¾¹ç•Œ

---

## å®è·µä»»åŠ¡

### ä»»åŠ¡1ï¼šç±»å‹éªŒè¯
ç¼–å†™æµ‹è¯•ä»£ç éªŒè¯å„ç±»å‹çš„å†…å­˜å¸ƒå±€å’Œç²¾åº¦ï¼š

```hlsl
// æµ‹è¯•ä¸åŒç²¾åº¦çš„æ•°å€¼èŒƒå›´
float f = 3.14159265359;
half h = 3.14159265359;  // è§‚å¯Ÿç²¾åº¦æŸå¤±

// æµ‹è¯•å‘é‡æ„é€ 
float4 vec = float4(1.0, 2.0, 3.0, 4.0);
float2 xy = vec.xy;
float4 duplicated = vec.xxxx;
```

### ä»»åŠ¡2ï¼šçŸ©é˜µå˜æ¢
å®ç°åŸºæœ¬çš„çŸ©é˜µå˜æ¢æ“ä½œï¼š

```hlsl
// åˆ›å»ºå•ä½çŸ©é˜µ
float4x4 identity = float4x4(1.0);

// åˆ›å»ºå¹³ç§»çŸ©é˜µ
float4x4 translation = float4x4(
    1.0, 0.0, 0.0, tx,
    0.0, 1.0, 0.0, ty,
    0.0, 0.0, 1.0, tz,
    0.0, 0.0, 0.0, 1.0
);

// å˜æ¢ç‚¹
float4 point = float4(1.0, 2.0, 3.0, 1.0);
float4 transformed = mul(point, translation);
```

### ä»»åŠ¡3ï¼šç»“æ„ä½“å¯¹é½
æµ‹è¯•ä¸åŒç»“æ„ä½“çš„å†…å­˜å¸ƒå±€ï¼š

```hlsl
// æµ‹è¯•å¯¹é½
struct TestStruct1 {
    float x;
    float y;
    float z;
    float w;
};

struct TestStruct2 {
    float x;
    float2 yz;
    float w;
};

// è§‚å¯Ÿä¸¤ä¸ªç»“æ„ä½“çš„å¤§å°å·®å¼‚
```

---

## ğŸ”— ç›¸å…³é“¾æ¥

- [[HLSL_Syntax_and_Semantics]]
- [[HLSL_Builtin_Functions]]
- [[Performance_Optimization]] - ç²¾åº¦é€‰æ‹©
- [[Resource_Binding]] - å¸¸é‡ç¼“å†²åŒºå¯¹é½

---

*æœ€åæ›´æ–°ï¼š2024å¹´*

